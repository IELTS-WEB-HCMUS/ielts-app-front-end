<link href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" rel="stylesheet">
<link rel="stylesheet" href="/styles/dashboard.css">
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
    integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://unpkg.com/bootstrap-table/dist/bootstrap-table.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/bootstrap-table/dist/bootstrap-table.min.css">

<style>
    .fixed-table-loading {
        display: none !important;
    }

    .viewresult {
        cursor: pointer;
    }

    #reso {
        cursor: pointer;
    }
</style>
<div style="display: flex; flex-direction: row; margin-top: 5%; margin: 5%;">
    <div style="margin-left: 3%; display: flex; flex-direction: column;">
        <img src="/assets/background_label2.png" style="width: 60%; height: auto; margin: 5%;" alt="Label2" />
        <img src="/assets/background_dashboard.png" style="width: 90%; height: auto; margin: 5%;" alt="Label2" />
    </div>
    <div class="row" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
        {{#each suggestQuizList}}
        {{> cardview this}}
        {{/each}}
    </div>
</div>

<div>
    <div class="wrapper" style="margin-top: 50px; width: 100%;">
        <h2 style="margin-left: 7%;">LỊCH SỬ LÀM BÀI</h2>
        <button id="button1"
            style="margin-left: 30%; background: #C1E3FB; border-radius: 3em; border: none; font-size: 1.5em; padding: 0.2em;"><strong>Theo
                passage</strong></button>
        <button id="button2"
            style="background: #C1E3FB; border-radius: 3em; border: none; font-size: 1.5em; padding: 0.2em;"><strong>Theo
                độ khó</strong></button>
        <div class="container">
            <table id="fresh-table" class="table table-bordered">
                <thead class="thead-dark">
                    {{!-- <th data-field="id" data-sortable="true">ID</th> --}}
                    <th data-field="name" data-sortable="true">TÊN BÀI</th>
                    <th data-field="salary" data-sortable="true">THỜI GIAN NỘP BÀI</th>
                    <th data-field="country" data-sortable="true">THỜI GIAN LÀM BÀI</th>
                    <th data-field="city" data-sortable="true">ĐIỂM</th>
                    <th data-field="actions">HÀNH ĐỘNG</th>
                </thead>
                <tbody>
                    {{#each statistic}}
                    <tr>
                        {{!-- <td>{{{ id }}}</td> --}}
                        <td>{{{ quiz_title }}}</td>
                        <td>{{{ date_created }}}</td>
                        <td>{{{ completed_duration }}} phút</td>
                        <td>{{{ success }}} / {{{ total }}}</td>
                        <td>
                            <span class="viewresult"
                                style="margin: 8%; width: 100%; background: #F0F1FA; color: #4F5AED; border-radius: 10%;"
                                onclick="localStorage.setItem('answer_id', '{{ id }}'); window.location.href = '/user/quiz-result?id={{ id }}';"><strong>Xem
                                    lại</strong></span>
                            <span id="reso" onclick="window.location.href='/user/dotest?id={{{ quiz_id }}}'"
                                style="width: 100%; background: #F0F1FA; color: #4F5AED; border-radius: 10%;"><strong>Làm
                                    lại</strong></span>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>
    </div>
</div>
</div>
</div>

<div class="performance-section">
    <div class="main-header">
        <h1>Hiệu suất làm bài của bạn</h1>
    </div>

    <div style="display: flex; margin: 20px 5%; gap: 20px;">
        <div style="display: flex; flex-direction: column; flex: 2; gap: 20px;">
            <div style="width: 100%;">
                {{> goal}}
            </div>
            <div style="width: 100%;">
                {{> calender}}
            </div>
        </div>

        <div style="flex: 1;">
            <div
                style="background-color: #CBE9FF; padding: 20px; border-radius: 20px; height: 100%; margin-top: -20px;">
                {{> target}}
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="/scripts/calendar.js"></script>
<script src="/scripts/goal.js"></script>
<script type="text/javascript">

    function formatDate(dateString) {
        var date = new Date(dateString);
        return date.toLocaleString('vi-VN', {
            weekday: 'short', // Hiển thị ngày trong tuần (optional)
            year: 'numeric',
            month: 'numeric',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    }

    $(document).ready(function () {
        // Lặp qua tất cả các ô có chứa ngày và giờ
        $('td').each(function () {
            var dateText = $(this).text();
            // Kiểm tra nếu giá trị là ngày giờ hợp lệ
            if (dateText && dateText.includes('T')) {
                // Chuyển đổi và cập nhật lại nội dung của ô
                $(this).text(formatDate(dateText));
            }
        });
    });
    var $table = $('#fresh-table');

    $(function () {
        $table.bootstrapTable({
            classes: 'table table-hover table-striped',
            search: true,
            showColumns: true,
            pagination: true,
            striped: true,
            sortable: true,
            pageSize: 8,
            pageList: [8, 10, 25],
            toolbar: '.toolbar',
            iconsPrefix: 'fa',
            icons: {
                sort: 'fa-sort',
                plus: 'fa-plus',
                columns: 'fa-filter',
                detailOpen: 'fa-plus',
                detailClose: 'fa-minus'
            },
            formatLoadingMessage: function () {
                return '';
            },
            formatShowingRows: function (pageFrom, pageTo, totalRows) {
                return '';
            },
            formatRecordsPerPage: function (pageNumber) {
                return pageNumber;
            }
        });
    });
</script>
<script>
    $(document).ready(function () {
        $('#button1, #button2').css('background', '#C1E3FB');

        const urlParams = new URLSearchParams(window.location.search);
        const type = urlParams.get('type');

        if (type == '2') {
            $('#button2').css('background', 'yellow');
        } else {
            $('#button1').css('background', 'yellow');
        }

        $('#button1').click(function () {
            $('#button2').css('background', '#C1E3FB');
            $(this).css('background', 'yellow');
            window.location.href = '/user/dashboard?type=1';
        });

        $('#button2').click(function () {
            $('#button1').css('background', '#C1E3FB');
            $(this).css('background', 'yellow');
            window.location.href = '/user/dashboard?type=2';
        });
    });

</script>